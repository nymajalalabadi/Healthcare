@model IEnumerable<Doctor>
@{
    ViewData["Title"] = "پزشکان";
}

<div class="px-4 py-6 sm:px-0">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">پزشکان</h1>
        <p class="text-gray-600 mt-2">بهترین پزشکان را انتخاب کنید</p>
    </div>

    <!-- Filters -->
    <div class="mb-6">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex flex-wrap items-center gap-4">
                <span class="text-gray-700 font-medium">فیلتر بر اساس تخصص:</span>
                <a href="/User/Doctors" class="px-4 py-2 rounded-full @(ViewBag.CurrentSpecialization == null ? "bg-blue-600 text-white" : "bg-gray-200 text-gray-700 hover:bg-gray-300")">همه</a>
                @if (ViewBag.Specializations != null)
                {
                    @foreach (var spec in ViewBag.Specializations)
                    {
                        <a href="/User/Doctors?specialization=@spec" class="px-4 py-2 rounded-full @(ViewBag.CurrentSpecialization == spec ? "bg-blue-600 text-white" : "bg-gray-200 text-gray-700 hover:bg-gray-300")">@spec</a>
                    }
                }
            </div>
        </div>
    </div>

    <!-- Doctors Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @foreach (var doctor in Model)
        {
            <div class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow p-6">
                <div class="text-center mb-4">
                    @if (!string.IsNullOrEmpty(doctor.ProfilePictureUrl))
                    {
                        <img src="@doctor.ProfilePictureUrl" alt="تصویر دکتر @doctor.FullName" 
                             class="w-20 h-20 rounded-full object-cover mx-auto mb-3 border-2 border-blue-100">
                    }
                    else if (doctor.ProfilePicture != null && doctor.ProfilePicture.Length > 0)
                    {
                        <img src="@Url.Action("GetDoctorProfilePicture", "Doctors", new { doctorId = doctor.Id })" alt="تصویر دکتر @doctor.FullName" 
                             class="w-20 h-20 rounded-full object-cover mx-auto mb-3 border-2 border-blue-100">
                    }
                    else
                    {
                        <div class="w-20 h-20 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-3">
                            <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                    }
                    <h3 class="text-lg font-bold text-gray-900">دکتر @doctor.FullName</h3>
                    <p class="text-blue-600 font-medium">@doctor.Specialization</p>
                </div>

                <div class="space-y-2 mb-4">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">تجربه:</span>
                        <span class="font-medium">@doctor.YearsOfExperience سال</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">امتیاز:</span>
                        <span class="font-medium">@doctor.Rating ⭐ (@doctor.ReviewCount نظر)</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">وضعیت:</span>
                        <span class="@(doctor.IsAvailable ? "text-green-600" : "text-red-600") font-medium">
                            @(doctor.IsAvailable ? "آنلاین" : "آفلاین")
                        </span>
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(doctor.Bio))
                {
                    <p class="text-gray-600 text-sm mb-4 line-clamp-2">@doctor.Bio</p>
                }

                <div class="flex space-x-2 space-x-reverse">
                    <a href="/User/Doctors/Details/@doctor.Id" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 text-center text-sm">
                        مشاهده جزئیات
                    </a>
                    @if (doctor.IsAvailable)
                    {
                        <button onclick="openBookingModal(@doctor.Id, '@doctor.FullName')" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 text-sm">
                            رزرو نوبت
                        </button>
                    }
                    else
                    {
                        <button disabled class="flex-1 bg-gray-400 text-white px-4 py-2 rounded-md cursor-not-allowed text-sm">
                            غیرفعال
                        </button>
                    }
                </div>
            </div>
        }
    </div>

    @if (!Model.Any())
    {
        <div class="text-center py-12">
            <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">پزشکی یافت نشد</h3>
            <p class="text-gray-600">در حال حاضر پزشکی با این مشخصات در دسترس نیست</p>
        </div>
    }
</div>

<!-- Booking Modal -->
<div id="bookingModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
        <h3 class="text-lg font-bold mb-4">رزرو مشاوره</h3>
        <form id="bookingForm" method="post" action="/User/Doctors/BookConsultation">
            <input type="hidden" id="doctorId" name="doctorId" />
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">نوع مشاوره</label>
                <select name="type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    <option value="1">چت متنی (50,000 تومان)</option>
                    <option value="2">تماس صوتی (80,000 تومان)</option>
                    <option value="3">تماس تصویری (120,000 تومان)</option>
                    <option value="4">حضوری (200,000 تومان)</option>
                </select>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">علائم و شکایات</label>
                <textarea name="symptoms" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="علائم خود را توضیح دهید..." required></textarea>
            </div>

            <div class="flex space-x-3 space-x-reverse">
                <button type="submit" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                    رزرو نوبت
                </button>
                <button type="button" onclick="closeBookingModal()" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400">
                    انصراف
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        function openBookingModal(doctorId, doctorName) {
            document.getElementById('doctorId').value = doctorId;
            document.querySelector('#bookingModal h3').textContent = 'رزرو مشاوره با دکتر ' + doctorName;
            document.getElementById('bookingModal').classList.remove('hidden');
        }

        function closeBookingModal() {
            document.getElementById('bookingModal').classList.add('hidden');
        }

        // Close modal when clicking outside
        document.getElementById('bookingModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeBookingModal();
            }
        });
    </script>
} 